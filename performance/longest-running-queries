# Pre 9.5

SELECT 'SELECT pg_cancel_backend(' || procpid ||');' AS to_cancel, date_trunc('second', current_timestamp - query_start) AS runtime, substr(current_query,1,75) AS query 
FROM pg_stat_activity 
WHERE current_query != '<IDLE>' 
AND upper(current_query) LIKE 'SELECT%' 
ORDER BY query_start limit 100;

# Post 9.5

SELECT 'SELECT pg_cancel_backend(' || pid ||');' AS to_cancel, date_trunc('second', current_timestamp - query_start) AS runtime, substr(query,1,75) AS query 
FROM pg_stat_activity 
WHERE query != '<IDLE>' 
AND upper(query) LIKE 'SELECT%' 
ORDER BY query_start limit 10;
